<script src='https://cdnjs.cloudflare.com/ajax/libs/tinymce/4.8.2/tinymce.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/tinymce/4.8.2/plugins/code/plugin.min.js'></script>
<script>
tinymce.PluginManager.add('youtubeIframe', function(editor) {
  // Add a button that opens a window
  editor.addButton('youtubeIframe', {
    text: 'Add Youtube Iframe',
    icon: false,
    onclick: function() {
      // Open window
      editor.windowManager.open({
        title: 'Youtube Iframe plugin',
        body: [
          {type: 'textbox', name: 'IframeURL', label: 'Iframe URL'}
        ],
        onsubmit: function(e) {
          var youtubeVideoEmbedUrl = "https://www.youtube.com/embed/" + e.data.IframeURL.match(/(?:https?:\/{2})?(?:w{3}\.)?youtu(?:be)?\.(?:com|be)(?:\/watch\?v=|\/embed\/|\/)([^\s&]+)/)[1];
          // Insert content when the window form is submitted
          editor.insertContent('<h2>Video Solution:</h2><p><iframe src="' + youtubeVideoEmbedUrl + '" width="560" height="315"></iframe></p>');
        }
      });
    }
  });

  return {
    getMetadata: function () {
      return  {
        name: "Example plugin",
        url: "http://exampleplugindocsurl.com"
      };
    }
  };
});
</script>
<script>
tinymce.init({
  selector: '#question_question',
  plugins: "link image code paste media",
  // TODO: to be added only if secure loading of plugin.js below is not working
  // content_security_policy: "default-src 'self' *.wiris.net *.amazonaws.com *.cloudflare.com; style-src 'self' 'unsafe-inline' *.cloudflare.com; img-src * data:;",
  external_plugins: { tiny_mce_wiris: 'https://www.neetprep.com/@wiris/mathtype-tinymce4/plugin.min.js' },
  // TODO: not sure why was this required but language going undefined in wiris editor somehow and gets fixed now
  language: 'en',
  toolbar: 'code,|,bold,italic,underline,|,cut,copy,paste,|,search,|,undo,redo,|,forecolor,backcolor,|,justifyleft,justifycenter,justifyright,fontselect,fontsizeselect,|,tiny_mce_wiris_formulaEditor,tiny_mce_wiris_formulaEditorChemistry,|,fullscreen,media',
  paste_data_images: true,
  images_upload_url: 'https://www.neetprep.com/api/v1/fileUpload/fileUpload',
  // TODO: seems wiris plugin is changing this to not have its images affected but ends up causing issue to our image upload..so adding this..anything better? this is especially added for data image which exist and images_dataimg_filter was anyway getting called for that
  editorObject: {'id': 'question_question'},
  video_template_callback: (data) => {
    return '<audio controls>' + '\n<source src="' + data.source1 + '"' + (data.source1mime ? ' type="' + data.source1mime + '"' : '') + ' />\n' + '</audio>';
  },
  setup: function (editor) {
    editor.on('blur', function (e) {
      document.getElementById('question_question').value = editor.getContent();
    });
    // TODO: seems wiris plugin is changing this to not have its images affected but ends up causing issue to our image upload..so adding this..anything better?
    editor.settings.images_dataimg_filter = function () {return undefined;};
  }
});
tinymce.init({
  selector: '#question_explanation',
  plugins: "link image code paste media youtubeIframe",
  // TODO: to be added only if secure loading of plugin.js below is not working
  // content_security_policy: "default-src 'self' *.wiris.net *.amazonaws.com *.cloudflare.com; style-src 'self' 'unsafe-inline' *.cloudflare.com; img-src * data:;",
  external_plugins: { tiny_mce_wiris: 'https://www.neetprep.com/@wiris/mathtype-tinymce4/plugin.min.js' },
  // TODO: not sure why was this required but language going undefined in wiris editor somehow and gets fixed now
  language: 'en',
  toolbar: 'code,|,bold,italic,underline,|,cut,copy,paste,|,search,|,undo,redo,|,forecolor,backcolor,|,justifyleft,justifycenter,justifyright,fontselect,fontsizeselect,|,tiny_mce_wiris_formulaEditor,tiny_mce_wiris_formulaEditorChemistry,|,fullscreen,media,|,youtubeIframe',
  paste_data_images: true,
  images_upload_url: 'https://www.neetprep.com/api/v1/fileUpload/fileUpload',
  // TODO: seems wiris plugin is changing this to not have its images affected but ends up causing issue to our image upload..so adding this..anything better? this is especially added for data image which exist and images_dataimg_filter was anyway getting called for that
  editorObject: {'id': 'question_explanation'},
  video_template_callback: (data) => {
    return '<audio controls>' + '\n<source src="' + data.source1 + '"' + (data.source1mime ? ' type="' + data.source1mime + '"' : '') + ' />\n' + '</audio>';
  },
  setup: function (editor) {
    editor.on('blur', function (e) {
      document.getElementById('question_explanation').value = editor.getContent();
    });
    // TODO: seems wiris plugin is changing this to not have its images affected but ends up causing issue to our image upload..so adding this..anything better?
    editor.settings.images_dataimg_filter = function () {return undefined;};
  }
});
</script>
<style>
.mce-tinymce.mce-container.mce-panel {
  display: inline-block !important;
  width: calc(80% - 22px) !important;
}
</style>
