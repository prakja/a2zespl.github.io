<%= render partial: "tinymce_ext_scripts" %>
<%= render partial: "tinymce_youtube_plugin" %>
<script>
tinymce.init({
  selector: '#test_syllabus',
  plugins: "link image code paste media youtubeIframe",
  // TODO: to be added only if secure loading of plugin.js below is not working
  // content_security_policy: "default-src 'self' *.wiris.net *.amazonaws.com *.cloudflare.com; style-src 'self' 'unsafe-inline' *.cloudflare.com; img-src * data:;",
  // TODO: not sure why was this required but language going undefined in wiris editor somehow and gets fixed now
  language: 'en',
  toolbar: 'code,|,bold,italic,underline,|,cut,copy,paste,|,search,|,undo,redo,|,forecolor,backcolor,|,justifyleft,justifycenter,justifyright,fontselect,fontsizeselect,|,fullscreen,media,|,youtubeIframe',
  paste_data_images: true,
  images_upload_url: 'https://www.neetprep.com/api/v1/fileUpload/fileUpload',
  // TODO: seems wiris plugin is changing this to not have its images affected but ends up causing issue to our image upload..so adding this..anything better? this is especially added for data image which exist and images_dataimg_filter was anyway getting called for that
  editorObject: {'id': 'test_syllabus'},
  video_template_callback: (data) => {
    return '<audio controls>' + '\n<source src="' + data.source1 + '"' + (data.source1mime ? ' type="' + data.source1mime + '"' : '') + ' />\n' + '</audio>';
  },
  file_picker_callback: function(cb, value, meta) {
    if (meta.filetype != "media") {
      return;
    }
    var input = document.createElement('input');
    input.setAttribute('type', 'file');
    input.setAttribute('accept', '*/*');/**/

    input.onchange = function() {
      const data = new FormData();
      data.append('file', this.files[0]);
      data.append('filename', this.files[0].name);

      fetch('https://www.neetprep.com/api/v1/fileUpload/fileUpload', {
        method: 'POST',
        body: data,
      }).then((response) => {
        response.json().then((body) => {
          cb(body.location);
        });
      });
    };
    input.click();
  },
  file_picker_type: 'media',
  setup: function (editor) {
    editor.on('blur', function (e) {
      document.getElementById('test_syllabus').value = editor.getContent();
    });
    // TODO: seems wiris plugin is changing this to not have its images affected but ends up causing issue to our image upload..so adding this..anything better?
    editor.settings.images_dataimg_filter = function () {return true;};
  }
});
</script>
<script>
tinymce.init({
  selector: '#test_resultMsgHtml',
  plugins: "link image code paste media youtubeIframe",
  // TODO: to be added only if secure loading of plugin.js below is not working
  // content_security_policy: "default-src 'self' *.wiris.net *.amazonaws.com *.cloudflare.com; style-src 'self' 'unsafe-inline' *.cloudflare.com; img-src * data:;",
  external_plugins: { tiny_mce_wiris: 'https://www.neetprep.com/@wiris/mathtype-tinymce4/plugin.min.js' },
  // TODO: not sure why was this required but language going undefined in wiris editor somehow and gets fixed now
  language: 'en',
  toolbar: 'code,|,bold,italic,underline,|,cut,copy,paste,|,search,|,undo,redo,|,forecolor,backcolor,|,justifyleft,justifycenter,justifyright,fontselect,fontsizeselect,|,tiny_mce_wiris_formulaEditor,tiny_mce_wiris_formulaEditorChemistry,|,fullscreen,media,|,youtubeIframe',
  paste_data_images: true,
  images_upload_url: 'https://www.neetprep.com/api/v1/fileUpload/fileUpload',
  // TODO: seems wiris plugin is changing this to not have its images affected but ends up causing issue to our image upload..so adding this..anything better? this is especially added for data image which exist and images_dataimg_filter was anyway getting called for that
  editorObject: {'id': 'test_resultMsgHtml'},
  video_template_callback: (data) => {
    return '<audio controls>' + '\n<source src="' + data.source1 + '"' + (data.source1mime ? ' type="' + data.source1mime + '"' : '') + ' />\n' + '</audio>';
  },
  file_picker_callback: function(cb, value, meta) {
    if (meta.filetype != "media") {
      return;
    }
    var input = document.createElement('input');
    input.setAttribute('type', 'file');
    input.setAttribute('accept', '*/*');

    input.onchange = function() {
      const data = new FormData();
      data.append('file', this.files[0]);
      data.append('filename', this.files[0].name);

      fetch('https://www.neetprep.com/api/v1/fileUpload/fileUpload', {
        method: 'POST',
        body: data,
      }).then((response) => {
        response.json().then((body) => {
          cb(body.location);
        });
      });
    };
    input.click();
  },
  file_picker_type: 'media',
  setup: function (editor) {
    editor.on('blur', function (e) {
      document.getElementById('test_resultMsgHtml').value = editor.getContent();
    });
    // TODO: seems wiris plugin is changing this to not have its images affected but ends up causing issue to our image upload..so adding this..anything better?
    editor.settings.images_dataimg_filter = function () {return true;};
  }
});
</script>
