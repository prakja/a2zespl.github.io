<script>
tinymce.PluginManager.add('youtubeIframe', function(editor) {
  // Add a button that opens a window
  editor.addButton('youtubeIframe', {
    text: 'Add Youtube Iframe',
    icon: false,
    onclick: function() {
      // Open window
      editor.windowManager.open({
        title: 'Youtube Iframe plugin',
        body: [
          {type: 'textbox', name: 'IframeURL', label: 'Iframe URL'},
          {type: 'textbox', name: 'startTime', label: 'start time in seconds'},
          {type: 'textbox', name: 'endtime', label: 'end time in seconds'}
        ],
        onsubmit: function(e) {
          var videoId = e.data.IframeURL.match(/(?:https?:\/{2})?(?:w{3}\.)?youtu(?:be)?\.(?:com|be)(?:\/watch\?v=|\/embed\/|\/)([^\s&]+)/)[1];
          var youtubeVideoEmbedUrl = "https://www.youtube.com/embed/" + videoId + "?rel=0&modestbranding=1&loop=1&playlist=" + videoId;
          if(e.data.startTime != null && e.data.startTime != '') {
            youtubeVideoEmbedUrl += '&start=' + e.data.startTime;
          }
          if(e.data.endtime != null && e.data.endtime != '') {
            youtubeVideoEmbedUrl += '&end=' + e.data.endtime;
          }
          // Insert content when the window form is submitted
          editor.insertContent('<div class="embed-responsive embed-responsive-16by9"><iframe src="' + youtubeVideoEmbedUrl + '" width="100%" allowfullscreen></iframe></div>');
        }
      });
    }
  });

  return {
    getMetadata: function () {
      return  {
        name: "Example plugin",
        url: "http://exampleplugindocsurl.com"
      };
    }
  };
});
</script>
