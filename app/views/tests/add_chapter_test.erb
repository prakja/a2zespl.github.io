<body>
  <div style="margin: 32px">
    <%= raw(@test.name) %>
  </div>
  <div style="margin: 32px">
    <label>Courses :</label>
    <select name="course" id="courseList" onchange="onCourseChange()">
      <option value=''>Select Course</option>
      <% @courses_data.each do |key, value| %>
        <%= raw("<option value='" + key.to_s + "'>" + value[0].to_s + "</option>") %>
      <% end %>
    </select>
    <br/><br/>
    <label>Subjects :</label>
    <select name="subject" id="subjectList" onchange="onSubjectChange()"></select>
    <br/><br/>
    <label>Chapters :</label>
    <select name="chapter" id="chapterList"></select>
  </div>
  <button onclick="addChapterTest()">Add selected Chapter test</button>
  <script type="text/javascript">

    function onCourseChange() {
      $("#subjectList").html("");
      $("#chapterList").html("");
      let url = window.location.origin + "/tests/getSubjectsList";
      let courseId = $('#courseList').val();
      $.ajax({
        type: "POST",
        url: url,
        dataType: "json",
        data: {
          "courseId": courseId
        }
      }).done (function (data) {
        option = "<option value=''>Select Subject</option>";
        $.each(data, function(key, value) {
          option += "<option value='" + key + "'>" + value[0] + "</option>";
        });
        $("#subjectList").html(option);
      });
    }

    function onSubjectChange() {
      $("#chapterList").html("");
      let url = window.location.origin + "/tests/getChaptersList";
      let subjectId = $('#subjectList').val();
      $.ajax({
        type: "POST",
        url: url,
        dataType: "json",
        data: {
          "subjectId": subjectId
        }
      }).done (function (data) {
        option = "<option value=''>Select Chapter</option>";
        $.each(data, function(key, value) {
          option += "<option value='" + key + "'>" + value[0] + "</option>";
        });
        $("#chapterList").html(option);
      });
    }

    function addChapterTest() {
      let chapterId = $("#chapterList option:selected").val();
      let testId = '<%= @test.id %>';
      if (chapterId == null){
        alert('Chapter is not selected');
        return
      }
      let url = window.location.origin + "/tests/createChapterTest";
      $.ajax({
        type: "POST",
        url: url,
        data: {
          "chapterId": chapterId,
          "testId": testId
        }
      }).done (function (data) {
        alert("done");
      });
    }

  </script>
</body>
